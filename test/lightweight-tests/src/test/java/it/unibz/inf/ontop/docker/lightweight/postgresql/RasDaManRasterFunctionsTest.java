package it.unibz.inf.ontop.docker.lightweight.postgresql;

import com.google.common.collect.ImmutableList;
import it.unibz.inf.ontop.docker.lightweight.AbstractDockerRDF4JTest;
import org.junit.jupiter.api.AfterAll;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.Test;

import java.io.IOException;
import java.sql.SQLException;

public class RasDaManRasterFunctionsTest extends AbstractDockerRDF4JTest {
    private static final String PROPERTIES_FILE = "/rasdaman/rasdaman.properties";
    private static final String OBDA_FILE = "/rasdaman/OntoRaster.obda";
    private static final String OWL_FILE = "/rasdaman/rasdaman.owl";

    @BeforeAll
    public static void before() throws IOException, SQLException {
        initOBDA(OBDA_FILE, OWL_FILE, PROPERTIES_FILE);
    }

    @AfterAll
    public static void after() throws SQLException {
        release();
    }

    //////////////////////////////
    ////// OntoRaster.obda ///////
    //////////////////////////////

    @Test
    public void testConnection() {

        String query1 = "PREFIX :\t<http://www.semanticweb.org/arkaghosh/OntoRaster/>\n"
                + "PREFIX rasdb:\t<http://www.semanticweb.org/RasterDataCube/>\n"
                + "SELECT * {\n"
                + "?x rasdb:hasConnection ?v .\n"
                + "}\n";

        executeAndCompareValues(query1, ImmutableList.of("\"RasDaMan is connected\"^^xsd:string"));
    }

    @Test
    public void getRasterArrayTemporal() {

        String query7 = "PREFIX :\t<http://www.semanticweb.org/arkaghosh/OntoRaster/>\n"
                + "PREFIX rdfs:\t<http://www.w3.org/2000/01/rdf-schema#>\n"
                + "PREFIX geo:\t<http://www.opengis.net/ont/geosparql#>\n"
                + "PREFIX rasdb:\t<http://www.semanticweb.org/RasterDataCube/>\n"
                + "SELECT ?v {\n"
                + "?x rasdb:hasRasterName ?raster_name .\n"
                + "FILTER (?raster_name = 'Surface_Temperature_Sweden'\n)"
                + "BIND (49 AS ?start_time\n)"
                + "BIND (50 AS ?end_time\n)"
                + "BIND (rasdb:rasSmallRasterArrayTemp(?start_time, ?end_time, ?raster_name) AS ?v)" //%s %s %s
                + "}\n";

        executeAndCompareValues(query7, ImmutableList.of("\"{{{0,0,0},{0,0,0},{0,0,0}},{{0,0,0},{0,0,0},{0,0,0}}}\"^^xsd:string")); //Array issue in RDF @Diego
    }

    @Test
    public void getRasterArraySpatial() {

        String query8 = "PREFIX :\t<http://www.semanticweb.org/arkaghosh/OntoRaster/>\n"
                + "PREFIX rdfs:\t<http://www.w3.org/2000/01/rdf-schema#>\n"
                + "PREFIX geo:\t<http://www.opengis.net/ont/geosparql#>\n"
                + "PREFIX rasdb:\t<http://www.semanticweb.org/RasterDataCube/>\n"
                + "SELECT ?v {\n"
                + "?x rasdb:hasRasterName ?raster_name .\n"
                + "FILTER (?raster_name = 'South_Tyrol_Temperature_MODIS_1km'\n)"
                + "BIND (rasdb:rasSmallRasterArraySpatial(49, ?raster_name) AS ?v)" //%s %s
                + "}\n";

        executeAndCompareValues(query8, ImmutableList.of("\"{{0,0,0},{0,0,0},{0,0,0}}\"^^xsd:string")); //Array issue in RDF @Diego
    }

    @Test
    public void clipRaster() {
        String query9 = "PREFIX :\t<http://www.semanticweb.org/arkaghosh/OntoRaster/>\n"
                + "PREFIX rdfs:\t<http://www.w3.org/2000/01/rdf-schema#>\n"
                + "PREFIX geo:\t<http://www.opengis.net/ont/geosparql#>\n"
                + "PREFIX rasdb:\t<http://www.semanticweb.org/RasterDataCube/>\n"
                + "SELECT ?v {\n"
                + "?r rdfs:label ?region_name .\n"
                + "?r geo:asWKT ?region .\n"
                + "?x rasdb:hasRasterName ?raster_name .\n"
                + "FILTER (?region_name = 'Ultimo'\n)" //Regen Erding Kelheim Link√∂ping Deggendorf Ultimo and ALSO change 3 params in geo2grid_coords function
//                + "FILTER (?raster_name = 'Baveria_Temperature_MODIS_1km'\n)" //Baveria_Temperature_MODIS_1km, Surface_Temperature_Sweden, South_Tyrol_Temperature_MODIS_1km
                + "BIND (100 AS ?time\n)"
                + "BIND (rasdb:rasClipRaster(?time, ?region, ?raster_name) AS ?v)"
                + "}\n";

        executeAndCompareValues(query9, ImmutableList.of("\"{{0,0,0,0,0,0,0,0,0,0,0,0,0,0,13749,0,0,13755,13754,0,0,0,0,0,0,0,0,13660,13660,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,0,0,13766,13769,13776,13776,13770,0,0,0,0,0,0,13721,13713,13707,13707,13706,13728,13728,13743,13727,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,0,13801,13801,13809,13812,13812,13798,13786,13786,13782,13782,13782,13756,13737,13737,13737,13733,13733,13741,13746,13746,13731,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,0,13803,13803,13803,13804,13804,13804,13818,13821,13821,13816,13816,13809,13781,13781,13779,13760,13760,13763,13743,13743,13735,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,0,0,13798,13798,13795,13793,13793,13805,13803,13803,13804,13803,13803,13775,13769,13769,13790,13796,13796,13739,13726,13726,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,0,0,13737,13756,13756,13774,13776,13776,13779,13788,13788,13799,13799,13788,13778,13778,13790,13802,13802,13761,13731,0,13716,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,0,13736,13741,13747,13747,13768,13766,13766,13761,13769,13769,13809,13806,13806,13793,13794,13794,13802,13780,13780,13739,13729,13729,13711,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,13739,13740,13743,13743,13741,13757,13757,13756,13754,13754,13753,13794,13794,13798,13798,13774,13768,13768,13777,13779,13779,13753,13743,13743,13717,13714,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,13706,13706,13712,13716,13716,13729,13737,13737,13749,13753,13753,13760,13775,13775,13791,13784,13784,13775,13773,13773,13770,13754,13754,13738,13725,13725,13716,13713,0,0,0,0,13673,0,13671,13653,13653,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,13708,13708,13710,13733,13733,13738,13755,13755,13762,13772,13772,13771,13772,13772,13772,13772,13780,13779,13779,13758,13753,13753,13742,13740,13740,13729,13731,13731,13727,13729,13729,13722,13721,13721,13693,13688,13688,13644,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,13714,13714,13713,13731,13731,13738,13758,13758,13763,13770,13770,13770,13761,13761,13758,13775,13775,13780,13776,13776,13774,13753,13753,13748,13742,13742,13739,13740,13740,13742,13740,13740,13742,13742,13729,13720,13720,13715,13670,13670,13675,13670,13670,13679,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,13721,13717,13717,13720,13721,13721,13743,13767,13767,13773,13779,13779,13770,13770,13757,13767,13767,13779,13778,13778,13778,13768,13768,13753,13753,13753,13756,13761,13761,13773,13775,13775,13767,13767,13767,13776,13777,13777,13718,13718,13718,13706,13707,13707,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,13727,13724,13724,13728,13722,13722,13732,13767,13767,13765,13780,13780,13779,13799,13799,13805,13773,13773,13772,13770,13770,13770,13755,13755,13753,13757,13757,13754,13752,13752,13746,13747,13747,13747,13747,13737,13726,13726,13756,13785,13785,13762,13738,13738,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,13788,13797,13797,13782,13778,13778,13762,13757,13757,13781,13797,13797,13813,13813,13818,13793,13793,13780,13768,13768,13761,13744,13744,13737,13735,13735,13734,13727,13727,13721,13728,13728,13743,13739,13739,13725,13732,13732,13748,13739,13739,13725,13718,13718,0,0,0,0,0,0},{0,0,13744,13744,0,0,0,0,0,0,0,13764,13767,13759,13759,13753,13749,13749,13754,13763,13763,13805,13854,13854,13845,13830,13830,13812,13779,13779,13767,13750,13750,13746,13745,13745,13744,13740,13740,13739,13729,13729,13729,13747,13747,13747,13747,13729,13730,13730,13740,13747,13747,13739,13741,0,0,0,0,0,0,0},{0,13713,13732,13732,13768,13776,0,0,0,13790,13793,13776,13776,13737,13743,13743,13758,13763,13763,13764,13773,13773,13809,13807,13807,13848,13848,13839,13759,13759,13756,13735,13735,13737,13750,13750,13750,13737,13737,13735,13743,13743,13748,13748,13748,13746,13752,13752,13755,13779,13779,13792,13771,13771,13760,0,0,0,0,0,0,0},{13701,13701,13703,13739,13739,13734,13734,13755,13750,13750,13770,13767,13767,13755,13755,13755,13789,13789,13789,13769,13773,13773,13781,13776,13776,13814,13817,13817,13781,13777,13777,13758,13755,13755,13753,13752,13752,13735,13728,13728,13746,13759,13759,13755,13751,13751,13755,13755,13760,13773,13773,13786,13763,13763,13729,13731,13731,0,0,0,0,0},{0,13685,13681,13701,13701,13705,13727,13727,13729,13747,13747,13749,13735,13735,13728,13741,13741,13743,13789,13789,13812,13772,13772,13748,13775,13775,13793,13793,13788,13788,13788,13774,13761,13761,13757,13747,13747,13744,13737,13737,13742,13755,13755,13756,13758,13758,13759,13766,13766,13772,13777,13777,13769,13737,13737,13735,13744,13744,13747,13756,0,0},{0,0,13679,13693,13703,13703,13705,13705,13707,13721,13721,13731,13723,13723,13719,13726,13726,13735,13750,13750,13769,13755,13755,13743,13750,13750,13772,13781,13781,13796,13791,13791,13774,13771,13771,13754,13749,13749,13744,13743,13743,13747,13749,13749,13757,13761,13761,13767,13767,13769,13767,13767,13764,13747,13747,13739,13743,13743,13747,13750,0,0},{0,13690,13690,13695,13699,13699,13703,13716,13716,13713,13697,13697,13700,13715,13715,13717,13727,13727,13734,13750,13750,13755,13755,13755,13759,13774,13774,13780,13780,13790,13793,13793,13781,13773,13773,13762,13752,13752,13751,13748,13748,13744,13741,13741,13747,13758,13758,13760,13762,13762,13757,13748,13748,13746,13737,13737,13736,13738,13738,13736,0,0},{0,0,13704,13704,13698,13697,13697,13710,13710,13713,13709,13709,13707,13732,13732,13744,13766,13766,13777,13777,13777,13781,13780,13780,13777,13775,13775,13764,13774,13774,13798,13796,13796,13782,13767,13767,13738,13735,13735,13732,13729,13729,13728,13731,13731,13737,13738,13738,13752,13754,13754,13744,13744,13743,13738,13738,13736,13741,13741,13746,0,0},{0,0,0,13708,13701,13698,13698,13704,13709,13709,13716,13734,13734,13753,13781,13781,13790,13803,13803,13792,13777,13777,13778,13781,13781,13780,13775,13775,13779,13779,13795,13798,13798,13780,13765,13765,13729,13724,13724,13723,13722,13722,13726,13732,13732,13739,13746,13746,13750,13753,13753,13749,13741,13741,13747,13762,13762,13763,0,0,0,0},{0,0,13713,13713,13713,13713,13713,13713,13715,13715,13716,13733,13733,13745,13785,13785,13793,13786,13786,13774,13752,13752,13751,13769,13769,13772,13772,13772,13770,13782,13782,13791,13782,13782,13779,13772,13772,13763,13749,13749,13720,13726,13726,13740,13744,13744,13759,13757,13757,13751,13749,13749,13736,13736,13735,13754,13754,13752,13752,13752,0,0},{0,0,13714,13716,13716,13716,13713,13713,13711,13712,13712,13727,13738,13738,13771,13790,13790,13778,13773,13773,13764,13754,13754,13748,13735,13735,13737,13740,13740,13754,13754,13783,13784,13784,13794,13789,13789,13764,13759,13759,13735,13738,13738,13732,13731,13731,13746,13747,13747,13746,13746,13746,13733,13730,13730,13740,13741,13741,13738,13734,13734,13733},{0,0,0,13703,13706,13706,13716,13715,13715,13711,13711,13726,13755,13755,13762,13777,13777,13779,13778,13778,13769,13749,13749,13745,13743,13743,13744,13734,13734,13734,13746,13746,13744,13794,13794,13795,13760,13760,13757,13748,13748,13748,13735,13735,13731,13741,13741,13745,13741,13741,13738,13735,13735,13734,13734,13728,13719,13719,13718,13717,13717,0},{0,0,0,13696,13702,13702,13719,13718,13718,13714,13718,13718,13757,13757,13757,13734,13729,13729,13746,13746,13746,13732,13732,13732,13749,13751,13751,13738,13736,13736,13752,13752,13760,13783,13783,13791,13782,13782,13779,13765,13765,13755,13743,13743,13732,13737,13737,13746,13746,13746,13743,13743,13743,13734,13735,13735,13742,13745,13745,13745,13747,13747},{0,0,0,0,0,13715,13715,13712,13712,13717,13718,13718,13750,13759,13759,13732,13722,13722,13733,13736,13736,13734,13735,13735,13749,13758,13758,13750,13743,13743,13757,13769,13769,13778,13795,13795,13793,13786,13786,13784,13777,13777,13779,13782,13782,13782,13764,13764,13763,13756,13756,13756,13736,13736,13735,13735,13747,13749,13749,13736,13728,13728},{0,0,0,0,0,0,0,13680,13697,13697,13715,13739,13739,13761,13740,13740,13716,13723,13723,13734,13736,13736,13738,13744,13744,13751,13745,13745,13733,13735,13735,13747,13747,13756,13808,13808,13807,13793,13793,13792,13794,13794,13798,13801,13801,13804,13773,13773,13770,13748,13748,13737,13735,13735,13734,13738,13738,13738,13730,13730,13718,13722},{0,0,0,0,0,13674,13681,13681,13698,13698,13746,13754,13754,13764,13752,13752,13703,13709,13709,13738,13738,13738,13743,13743,13743,13745,13743,13743,13731,13731,13731,13752,13754,13754,13777,13777,13777,13781,13788,13788,13807,13815,13815,13812,13806,13806,13788,13774,13774,13764,13742,13742,13739,13732,13732,13736,13736,13740,13738,13738,13724,13727},{0,0,0,0,0,13691,13691,13691,13694,13764,13764,13762,13747,13747,13741,13712,13712,13714,13724,13724,13723,13736,13736,13736,13729,13729,13731,13731,13731,13734,13746,13746,13755,13755,13760,13768,13768,13767,13776,13776,13779,13791,13791,13788,13785,13785,13782,13770,13770,13766,13752,13752,13749,13740,13740,13743,13747,13747,13746,13735,13735,0},{0,0,0,0,0,0,0,13783,13783,13760,13760,13739,13721,13721,13713,13717,13717,13720,13719,13719,13719,13725,13725,13726,13721,13721,13721,13726,13726,13737,13743,13743,13763,13762,13762,13750,13746,13746,13746,13751,13751,13772,13776,13776,13777,13776,13776,13760,13755,13755,13760,13762,13762,13762,13762,13762,13755,0,0,0,0,0},{0,0,0,0,0,0,0,13779,13779,13772,13736,13736,13736,13732,13732,13729,13720,13720,13717,13716,13716,13719,13727,13727,13724,13718,13718,13721,13735,13735,13737,13746,13746,13746,13746,13727,13719,13719,13757,13769,13769,13770,13768,13768,13767,13770,13770,13760,13749,0,13757,0,13768,13766,13760,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,13758,13754,13754,13756,13752,13752,13750,13737,13737,13737,13724,13724,13725,13719,13719,13716,13718,13718,13720,13732,13732,13732,13730,13730,13733,13722,13722,13710,13733,13733,13769,13766,13766,13771,13774,13774,13781,13780,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,13759,13758,13759,13759,13770,13771,13771,13763,13761,13761,13744,13735,13735,13727,13713,13713,13714,13715,13715,13711,13706,13706,13705,13714,13714,13710,13710,13697,13696,13696,13735,13735,13735,13781,13785,13785,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,13756,13752,13747,13747,13746,13759,13759,13761,13778,13778,13775,13705,13705,13705,13692,13692,13692,13691,13691,13693,13708,13708,13710,13707,13707,13709,13728,13728,13735,13763,13763,13778,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,0,13737,13725,13724,13724,13754,13754,13754,13781,13785,13785,13760,13764,13764,13731,13721,13721,13714,13710,13710,13713,13714,13714,13716,13721,13721,13728,13728,13732,13745,13745,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13744,13769,13784,13784,13784,13787,13787,13764,13749,13749,13747,13743,13743,13753,13768,13768,13767,13749,13749,13744,13727,13727,13730,13753,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13745,0,13783,13782,13782,13780,13776,13776,13764,13767,13767,13779,13779,13779,13765,13768,13768,13761,13761,13764,13758,13758,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13739,13733,13733,13756,13756,13756,13778,13780,13780,13783,13784,13784,13778,13778,13778,13776,13778,13778,13769,13761,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13722,13722,13726,13735,13735,13736,13739,13739,13736,13739,13739,13753,13764,13764,13778,13779,13779,13784,13784,13780,13758,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13756,13756,13735,13732,13732,13727,13727,13727,13720,13719,13719,0,13745,13745,13757,13756,13756,13754,13750,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13750,13746,13736,13736,13734,13711,13711,13704,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13736,13732,13719,13719,13702,13709,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13737,0,13703,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}}\"^^xsd:string")); //xsd:array is not available
    }

    @Test
    public void clipRasterWithCustomGeometry() {

        String query6 = "PREFIX :\t<http://www.semanticweb.org/arkaghosh/OntoRaster/>\n"
                + "PREFIX rdfs:\t<http://www.w3.org/2000/01/rdf-schema#>\n"
                + "PREFIX geo:\t<http://www.opengis.net/ont/geosparql#>\n"
                + "PREFIX rasdb:\t<http://www.semanticweb.org/RasterDataCube/>\n"
                + "SELECT ?v {\n"
                + "?x rasdb:hasRasterName ?raster_name .\n"
                + "BIND ('POLYGON((11.324157714843748 48.29050321714061,11.911926269531248 48.279537342260085,11.88995361328125 48.01932418480118,11.340637207031248 48.01564978668938,11.324157714843748 48.29050321714061))' AS ?usr_polygon\n)"
                + "FILTER (CONTAINS(?raster_name, 'Baveria')\n)"
                + "BIND (rasdb:rasClipRasterAnyGeom(246, ?usr_polygon, ?raster_name) AS ?v)"
                + "}\n";

        executeAndCompareValues(query6, ImmutableList.of("\"{{14335,14347,14341,14341,14322,14319,14319,14326,14324,14324,14303,14312,14312,14304,14324,14324,14348,14366,14366,14366,14348,14348,14325,14317,14317,14317,14320,14320,14344,14381,14381,14310,14357,14357,14348,14330," + "0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}," +  "{14337,14337,14346,14347,14347,14323,14304,14304,14323,14309,14309,14309,14311,14311,14329,14362,14362,14386,14357,14357,14318,14291,14291,14294,14295,14295,14293,14334,14334,14403,14403,14403,14380,14361,14361,14312,14272,14272,14298,14279,14279,14299,14296,14296,14287,14277,14277,14255,14230,14230,14231,14248,14248,14264,14274,14274,14274,14261,14261,14293,14292,14292,14280,14285,14285,14292,14274,14274,14270,14274,14274},{14349,14349,14357,14375,14375,14328,14315,14315,14333,14329,14329,14321,14327,14327,14330,14386,14386,14393,14317,14317,14303,14291,14291,14296,14307,14307,14296,14348,14348,14388,14384,14384,14351,14335,14335,14310,14284,14284,14291,14288,14288,14288,14290,14290,14288,14275,14275,14238,14220,14220,14231,14245,14245,14254,14265,14265,14257,14258,14258,14270,14273,14273,14271,14290,14290,14302,14307,14307,14279,14250,14250},{14326,14318,14318,14342,14331,14331,14330,14329,14329,14317,14293,14293,14357,14420,14420,14407,14400,14400,14317,14307,14307,14312,14321,14321,14317,14312,14312,14340,14357,14357,14351,14343,14343,14318,14296,14296,14269,14285,14285,14314,0,0,14318,14302,14302,14291,14267,14267,14256,14256,14258,14251,14251,14262,14264,14264,14255,14257,14257,14263,14271,14271,14262,14281,14281,14293,14296,14296,14288,14250,14250},{14307,14314,14314,14315,14332,14332,14350,14335,14335,14345,14357,14357,14412,14424,14424,14415,14375,14375,14354,14372,14372,14347,14331,14331,14333,14337,14337,14333,14364,14364,14373,14344,14344,14347,14327,14327,14272,14303,14303,14364,14354,14354,14318,14313,14313,14301,14275,14275,14248,14242,14242,14236,14250,14250,14262,14262,14262,14262,14264,14264,14274,14282,14282,14288,14290,14290,14296,14279,14279,14254,14246},{14306,14312,14331,14331,14356,14372,14372,14337,14345,14345,14354,14354,14372,14398,14398,14408,14385,14385,14371,14372,14372,14352,14344,14344,14357,14360,14360,14338,14316,14316,14317,14335,14335,14363,14365,14365,14308,14318,14318,14360,14348,14348,14331,14311,14311,14292,14268,14268,14252,14247,14247,14244,14246,14246,14269,14278,14278,14285,14288,14288,14285,14284,14284,14288,14279,14279,14279,14269,14269,14248,14243},{14323,14325,14376,14376,14387,14362,14362,14338,14326,14326,14325,14323,14323,14365,14396,14396,14392,14388,14388,14374,14360,14360,14339,14363,14363,14343,14353,14353,14338,14311,14311,14305,14344,14344,14324,14304,14304,14310,14324,14324,14342,14347,14347,14326,14280,14280,14266,14259,14259,14252,14257,14257,14266,14280,14280,14285,14271,14271,14263,14260,14260,14276,14282,14282,14279,14272,14272,14263,14256,14256,14259},{14354,14337,14371,14371,14363,14344,14344,14323,14312,14312,14302,14306,14306,14333,14354,14354,14377,14395,14395,14366,14365,14365,14348,14359,14359,14371,14374,14374,14387,14368,14368,14363,14373,14373,14355,14320,14320,14304,14312,14312,14337,14368,14368,14381,14306,14306,14268,14261,14261,14245,14247,14247,14278,14317,14317,14343,14287,14287,14256,14275,14275,14283,14281,14281,14277,14263,14263,14262,14249,14249,14264},{14388,14388,14400,14383,14383,14342,14312,14312,14310,14307,14307,14316,14328,14328,14333,14330,14330,0,0,0,14368,14369,14369,14371,14385,14385,14380,14395,14395,14382,14358,14358,14365,14377,14377,14359,14356,14356,14343,14355,14355,14372,14396,14396,14326,14286,14286,14303,14344,14344,14392,14402,14402,14414,14408,14408,14373,14336,14336,14303,14292,14292,14284,14277,14277,14263,14259,14259,14251,14244,14244},{0,14398,14414,14410,14410,14387,14369,14369,14346,14333,14333,14326,14328,14328,14324,14324,14324,14416,0,0,0,14379,14379,14412,14414,14414,14409,14402,14402,14387,14348,14348,14364,14398,14398,14398,0,0,14373,14378,14378,14361,14336,14336,14325,14330,14330,14364,14431,14431,14454,14510,14510,14498,14428,14428,14379,14343,14343,14304,14287,14287,14292,14301,14301,14284,14261,14261,14257,14251,0},{0,14391,14391,14398,14410,14410,14408,14368,14368,14347,14332,14332,14348,14367,14367,14382,14417,14417,14416,14422,14422,14394,14396,14396,14414,14438,14438,14426,14426,14426,0,0,0,14398,0,0,0,14384,14384,14387,14364,14364,14378,14406,14406,14400,14375,14375,14396,14344,14344,14317,14276,14276,14267,14279,14279,14295,14311,14311,14305,14298,14298,14296,14298,14298,14269,14249,14249,14252,0},{0,14367,14367,14378,14394,14394,14398,14359,14359,14347,14335,14335,14369,14402,14402,14412,14435,14435,14439,14422,14422,14415,14390,14390,14403,14438,14438,14426,14426,14426,0,0,0,0,0,0,0,14384,14384,14386,14369,14369,14360,14363,14363,14299,14266,14266,14267,14266,14266,14274,14298,14298,14333,14291,14291,14308,14315,14315,14307,14296,14296,14288,14291,14291,14278,14249,14249,14241,0},{0,14364,14375,14375,14375,14386,14386,14392,14353,14353,14330,14359,14359,14393,14410,14410,14419,0,0,14423,14423,14423,0,0,0,0,0,0,0,0,0,0,0,0,0,14402,14402,14402,14296,14296,14306,14303,14303,14295,14287,14287,14286,14287,14287,14285,14287,14287,14302,14323,14323,14323,14316,14316,14309,14301,14301,14292,14296,14296,14298,14278,14278,14249,14238,14238,0},{0,14393,14384,14384,14368,14375,14375,14396,14384,14384,14386,14369,14369,14371,14391,14391,14408,0,0,0,14436,14436,14436,0,0,0,0,0,0,0,0,0,0,0,14406,14404,14404,14398,0,0,14293,14260,14260,14263,14286,14286,14319,14373,14373,14328,14303,14303,14300,14303,14303,14303,14316,14316,0,14311,14311,14305,14294,14294,14281,14263,14263,14231,14231,14231,0},{0,14415,14416,14346,14346,14327,14361,14361,14391,14419,14419,14408,14371,14371,14379,14411,14411,14415,14454,14454,14445,14439,14439,14443,14443,14443,14452,14453,14453,0,14458,14458,14418,14415,14415,14407,14403,14403,14404,14280,14280,14271,14263,14263,14305,14320,14320,14347,14347,14347,14383,14367,14367,14325,14292,14292,14314,14307,14307,14344,14325,14325,14302,14276,14276,14255,14233,14233,14229,14239,0},{0,14366,14357,14346,14346,14330,14339,14339,14371,14399,14399,14412,14411,14411,14379,14405,14405,14438,14451,14451,14447,14464,14464,14464,14452,14452,14455,14453,14453,14458,14458,14458,0,14425,14425,14410,14399,14399,14387,14360,14360,14315,14269,14269,14309,14320,14320,14341,14358,14358,14385,14384,14384,14327,14303,14303,14296,14287,14287,14321,14304,14304,14289,14273,14273,14257,14217,14217,14233,14247,0},{0,14309,14312,14311,14311,14314,14343,14343,14370,14382,14382,14394,14411,14411,0,0,0,14454,14454,14454,14443,14468,14468,14469,14471,14471,14471,0,0,0,14458,14458,0,14447,14447,14431,14408,14408,14385,14373,14373,14326,14291,14291,14284,14321,14321,14330,14358,14358,14379,14371,14371,14291,14302,14302,14264,14286,14286,14284,14284,14284,14287,14285,14285,14271,14254,14254,14265,14267,0},{0,14305,14305,14338,14356,14356,14380,14383,14383,14383,14377,14377,0,0,0,14453,0,0,0,0,0,14469,14469,14469,0,0,0,14466,14466,14466,0,14457,14457,14459,14455,14455,14424,14393,14393,14375,14350,14350,14334,14334,14334,14331,14330,14330,14356,14361,14361,14283,14291,14291,14301,14301,14301,14300,14293,14293,14303,14292,14292,14293,14285,14285,14283,14277,14277,14257,0},{0,14341,14341,14385,14397,14397,14401,14402,14402,14401,14401,14401,0,0,0,14453,14450,14450,14438,14438,14438,0,0,0,0,0,0,14464,14453,14453,14455,14447,14447,14447,0,0,14411,14407,14407,14384,14353,14353,0,0,0,0,14287,14287,14289,14294,14294,14283,14293,14293,14297,14297,14297,14301,14294,14294,14297,14290,14290,14289,14288,14288,14277,14255,14255,14243,0},{0,14357,14378,14378,14387,14401,14401,14397,14397,14397,14411,14456,14456,14462,14442,14442,14431,14438,14438,14438,0,0,0,0,0,0,0,0,14447,14456,14456,14457,14456,14456,0,0,0,14417,14417,14417,0,0,0,14334,14334,14334,14349,14297,14297,14283,14272,14272,14272,14280,14280,14275,14291,14291,14287,14290,14290,14291,14291,14291,14301,14278,14278,14252,14246,14246,0},{0,14340,14349,14349,14376,0,0,14403,14401,14401,14425,14455,14455,14463,14455,14455,14428,0,0,0,0,0,0,14461,14461,14461,0,0,0,14458,14458,14458,14456,14456,0,14393,14393,14409,14407,14407,14403,0,0,0,14334,14334,14345,14319,14319,14298,14309,14309,14334,14290,14290,14283,14286,14286,14281,14281,14281,14291,14284,14284,14313,14294,14294,14269,14250,14250,0},{0,14336,14325,14363,14363,14383,14382,14382,14394,14432,14432,14446,14441,14441,14423,14410,14410,0,0,0,14452,14452,14452,14462,14463,14463,0,14447,14447,14447,14447,14447,14417,14410,14410,14400,14394,14394,14399,14403,14403,0,0,0,0,14350,14350,14334,14299,14299,14315,14368,14368,14357,14332,14332,14304,14290,14290,14280,14294,14294,14287,14288,14288,14291,14280,14280,14259,14251,0},{0,14340,14327,14343,14343,14374,14377,14377,14389,14423,14423,14435,14420,14420,14395,14426,14426,14429,14435,14435,14452,14455,14455,14463,14463,14463,0,14436,14436,14440,14424,14424,14413,14414,14414,14406,0,0,0,0,0,14346,14352,14352,14370,14398,14398,14363,14348,14348,14343,14356,14356,14368,14350,14350,14382,14323,14323,14303,14297,14297,14300,14309,14309,14300,14267,14267,14267,14266,0},{0,14303,14316,14356,14356,14362,14364,14364,14389,14418,14401,14401,14409,14375,14375,14422,14440,14440,14440,14442,14442,14448,0,0,0,0,0,14436,14423,14423,14402,14389,14389,0,0,0,14394,14394,14394,0,14339,14339,14337,14343,14343,14343,14356,14356,14351,14345,14345,14348,14379,14379,14353,14378,14378,14370,14337,14337,14311,14310,14310,14303,14312,14312,14297,14290,14290,14288,0},{0,14355,14355,14359,14367,14367,14383,14390,14390,14390,14375,14375,14388,14389,14389,14406,14417,14417,14403,14421,14421,14419,14411,14411,14411,14411,14411,14402,14381,14381,14357,14354,14354,14362,14388,14388,14386,14373,14373,0,14378,14378,14329,14340,14340,14319,14305,14305,14321,14341,14341,14332,14348,14348,14346,14334,14334,14318,14330,14330,14311,14310,14310,14303,14311,14311,14319,14324,14324,14324,0},{0,0,14292,14296,14354,14354,14407,14396,14396,14388,14391,14391,14405,14406,14406,14400,14388,14388,14387,14417,14417,14413,14401,14401,14400,14409,14409,14394,14345,14345,14309,14324,14324,14353,14382,14385,14385,14352,14348,14348,14378,14378,14378,14351,14342,14342,14316,14297,14297,14302,14300,14300,14313,14328,14328,14323,14321,14321,14319,14302,14302,14292,14282,14282,14307,14321,14321,14333,14339,0,0},{0,0,14309,14309,14366,14393,14393,14386,14369,14369,14359,14362,14362,14367,14393,14393,14362,14364,14364,14376,14373,14373,14359,14370,14370,14404,14385,14385,14343,14316,14316,14315,14333,14333,14378,14356,14356,14324,14332,14332,14342,0,0,14359,14357,14357,14339,14326,14326,14326,14318,14318,14315,14331,14331,14311,14313,14313,14328,14313,14313,14306,14296,14296,14300,14297,14297,14312,14352,0,0},{0,0,14299,14299,14334,14361,14361,14361,14340,14340,14319,14336,14336,14357,14355,14355,14350,14354,14354,14366,14374,14374,14365,14389,14389,14388,14371,14371,14342,14320,14320,14319,14305,14305,14348,14345,14345,14319,14326,14326,14361,0,0,14366,14352,14352,14334,14332,14332,14331,14330,14330,14329,14320,14311,14311,14330,14361,14361,14354,14341,14341,14324,14311,14311,14317,14336,14336,14323,0,0},{0,0,14318,14330,14330,14327,14340,14340,14341,14325,14325,14333,14349,14349,14353,14347,14347,14358,14368,14368,14371,14376,14376,14381,14375,14375,14357,14329,14329,14330,14332,14332,14360,14373,14373,14338,14319,14319,14304,14326,14326,14334,14329,14329,14338,14309,14309,14302,14318,14318,14326,14321,14321,14320,14307,14307,14337,14352,14352,14359,14355,14355,14344,14338,14338,14342,14343,14343,14310,0,0},{0,0,14319,14350,14350,14372,14390,14390,14395,14375,14375,14363,14372,14372,14363,14360,14360,14365,14367,14367,14370,14373,14373,14387,14393,14393,14360,14330,14330,14330,14339,14339,14327,14354,14354,14338,14310,14310,14290,14285,14285,14306,14307,14307,14295,14299,14299,14309,14327,14327,14345,14339,14339,14346,14342,14342,14360,14374,14374,14371,14341,14341,14350,14358,14358,14342,14333,14333,14335,0,0},{0,0,14335,14366,14387,14387,14405,14412,14412,14401,14391,14391,14398,14391,14391,14380,14365,14365,14366,14372,14372,14375,14378,14378,14394,14339,14339,14337,14333,14333,14326,14315,14315,14321,14318,14318,14301,14273,14273,14280,14311,14311,14314,14295,14295,14292,14320,14320,14348,14360,14360,14374,14372,14372,14373,14375,14375,14364,14358,14358,14362,14366,14366,14345,14322,14322,14299,14282,14282,0,0},{0,0,14365,14369,14364,14364,14364,14362,14362,14383,14387,14387,14398,14396,14396,14387,14372,14372,14369,14360,14360,14362,14371,14371,14367,14348,14348,14348,14336,14336,14326,14320,14320,14306,14286,14286,14294,14276,14276,14284,14303,14303,14307,14289,14289,14292,14322,14322,14338,14332,14332,14342,14365,14365,14370,14361,14361,14332,14327,14327,14334,14332,14332,14321,14330,14330,14298,14269,14269,0,0},{0,0,14352,14372,14350,14350,14351,14374,14374,14396,14367,14365,14365,14368,14377,14377,14376,14359,14359,14342,14345,14345,14356,14361,14361,14351,14339,14339,14322,14307,14307,14311,14307,14307,14278,14284,14284,14296,14295,14295,14293,14303,14303,14309,14292,14292,14300,14311,14311,14310,14305,14305,14338,14346,14346,14344,14328,14328,14327,14342,14342,14362,14341,14341,14336,14332,14332,14301,14271,0,0},{0,0,14365,14365,14327,14303,14303,14358,14363,14363,14357,14352,14352,14367,14381,14381,14387,14387,14387,14359,14357,14357,14347,14348,14348,14343,14323,14323,14309,14291,14291,14297,14287,14287,14279,14292,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}}\"^^xsd:string")); //xsd:array is not available
    }


    @Test
    public void minRasterSPATIALX() {

        String query10 = "PREFIX :\t<http://www.semanticweb.org/arkaghosh/OntoRaster/>\n"
                + "PREFIX rdfs:\t<http://www.w3.org/2000/01/rdf-schema#>\n"
                + "PREFIX geo:\t<http://www.opengis.net/ont/geosparql#>\n"
                + "PREFIX rasdb:\t<http://www.semanticweb.org/RasterDataCube/>\n"
                + "SELECT ?v {\n"
                + "?r rdfs:label ?region_name .\n"
                + "?r geo:asWKT ?region .\n"
                + "?x rasdb:hasRasterName ?raster_name .\n"
                + "?x rasdb:hasMinLongitude ?min_lon .\n"
                + "?x rasdb:hasMaxLatitude ?max_lat .\n"
                + "?x rasdb:hasSpatialResolution_lon ?x_res .\n"
                + "?x rasdb:hasSpatialResolution_lat ?y_res .\n"
                + "FILTER (?region_name = 'M√ºnchen'\n)" //Vector region = Regen Erding, Kelheim, Link√∂ping, Ultimo
                + "FILTER (CONTAINS(?raster_name, 'Baveria')\n)" //Raster Dataset = Bavaria_Temperature_MODIS_1km, Surface_Temperature_Sweden, South_Tyrol_Temperature_MODIS_1km
                + "BIND (100 AS ?time\n)"
                + "BIND (rasdb:rasSpatialMinimumX(?time, ?region, ?min_lon, ?max_lat, ?x_res, ?y_res, ?raster_name) AS ?v)"
                + "}\n";

        executeAndCompareValues(query10, ImmutableList.of("\"13554\"^^xsd:integer"));
    }

    @Test
    public void maxRasterSPATIALX() {

        String query10 = "PREFIX :\t<http://www.semanticweb.org/arkaghosh/OntoRaster/>\n"
                + "PREFIX rdfs:\t<http://www.w3.org/2000/01/rdf-schema#>\n"
                + "PREFIX geo:\t<http://www.opengis.net/ont/geosparql#>\n"
                + "PREFIX rasdb:\t<http://www.semanticweb.org/RasterDataCube/>\n"
                + "SELECT ?v {\n"
                + "?r rdfs:label ?region_name .\n"
                + "?r geo:asWKT ?region .\n"
                + "?x rasdb:hasRasterName ?raster_name .\n"
                + "?x rasdb:hasMinLongitude ?min_lon .\n"
                + "?x rasdb:hasMaxLatitude ?max_lat .\n"
                + "?x rasdb:hasSpatialResolution_lon ?x_res .\n"
                + "?x rasdb:hasSpatialResolution_lat ?y_res .\n"
                + "FILTER (?region_name = 'Stockholm'\n)" //Vector region = Regen Erding, Kelheim, Link√∂ping, Ultimo
                + "FILTER (CONTAINS(?raster_name, 'Sweden')\n)" //Raster Dataset = Bavaria_Temperature_MODIS_1km, Surface_Temperature_Sweden, South_Tyrol_Temperature_MODIS_1km
                + "BIND (100 AS ?time\n)"
                + "BIND (rasdb:rasSpatialMaximumX(?time, ?region, ?min_lon, ?max_lat, ?x_res, ?y_res, ?raster_name) AS ?v)"
                + "}\n";

        executeAndCompareValues(query10, ImmutableList.of("\"14432\"^^xsd:integer"));
    }





/*//    @Test
//    public void checkBBOX(){
//        String query02 =
//                "PREFIX rasdb:\t<http://www.semanticweb.org/RasterDataCube/>\n"
//                + "SELECT * {\n"
//              + "?r rdfs:label ?region_name .\n"
//                + "?r geo:asWKT ?regionBBOX .\n"
//                + "?x rasdb:hasRasterName ?raster_name .\n"
//                + "?x rasdb:hasRasterBBOX /\n"
//                + "BIND (rasdb:rasCheckBBOX(?regionBBOX, ?rasterBBOX) AS ?v)"
//                + "}\n";
//
//        executeAndCompareValues(query2, ImmutableList.of("\"array\"^^xsd:string"));
//    }*/

}
